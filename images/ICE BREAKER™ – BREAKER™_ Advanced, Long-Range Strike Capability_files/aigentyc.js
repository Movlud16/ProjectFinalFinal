var aiGentyc=function(){"use strict";var t=Object.defineProperty,e=(e,n,o)=>((e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o)(e,"symbol"!=typeof n?n+"":n,o);const n={project:"",mode:"managed",position:"bottom-right",buttonColor:"#1735aa",buttonText:"",buttonIcon:"",zIndex:9999,trigger:"",container:"",lang:"en",baseUrl:"https://tyco-ai.tycontrol.me",popupWidth:"400px",popupHeight:"600px",popupMaxWidth:"calc(100vw - 40px)",popupMaxHeight:"calc(100vh - 120px)",popupSize:"small"};function o(){const t=function(){if(document.currentScript)return document.currentScript;const t=document.querySelectorAll("script[data-project]");if(t.length>0)return t[t.length-1];const e=document.querySelectorAll('script[src*="aigentyc"], script[src*="index.ts"]');for(const n of e)if(n.dataset.project)return n;return null}();if(!t)return console.warn("[aiGentyc] Could not find script element, using defaults"),{...n};const e={project:t.dataset.project||n.project,mode:t.dataset.mode||n.mode,position:t.dataset.position||n.position,buttonColor:t.dataset.buttonColor||n.buttonColor,buttonText:t.dataset.buttonText||n.buttonText,buttonIcon:t.dataset.buttonIcon||n.buttonIcon,zIndex:parseInt(t.dataset.zIndex||"",10)||n.zIndex,trigger:t.dataset.trigger||n.trigger,container:t.dataset.container||n.container,lang:t.dataset.lang||n.lang,baseUrl:t.dataset.baseUrl||n.baseUrl,popupWidth:t.dataset.popupWidth||n.popupWidth,popupHeight:t.dataset.popupHeight||n.popupHeight,popupMaxWidth:t.dataset.popupMaxWidth||n.popupMaxWidth,popupMaxHeight:t.dataset.popupMaxHeight||n.popupMaxHeight,popupSize:t.dataset.popupSize||n.popupSize};return e.project||console.error("[aiGentyc] Missing required data-project attribute"),"custom"!==e.mode||e.trigger&&e.container||console.error("[aiGentyc] Custom mode requires data-trigger and data-container attributes"),e}const i=new class{constructor(){e(this,"listeners",new Map)}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){const n=this.listeners.get(t);n&&n.delete(e)}emit(t,e){const n=this.listeners.get(t);n&&n.forEach(n=>{try{n(e)}catch(o){console.error(`[aiGentyc] Error in ${t} handler:`,o)}})}clear(){this.listeners.clear()}};let a=null,r=!1,l=null;function s(t,e){if(a||(a=a||(a=document.createElement("iframe"),a.setAttribute("allow","clipboard-write"),a.setAttribute("sandbox","allow-same-origin allow-scripts allow-popups allow-forms allow-presentation"),a.setAttribute("loading","lazy"),a)),r)return;const n=function(t){return`${t.baseUrl}/app/${t.lang}/${t.project}`}(t);l=setTimeout(()=>{i.emit("error",new Error("Iframe load timeout"))},1e4),a.onload=()=>{l&&(clearTimeout(l),l=null),r=!0,i.emit("ready")},a.onerror=()=>{l&&(clearTimeout(l),l=null),i.emit("error",new Error("Iframe failed to load"))},e.appendChild(a),a.src=n}function c(t){if(!t.data||"object"!=typeof t.data)return;const{type:e}=t.data;if("chatStarted"===e)i.emit("chatStarted")}function d(){l&&(clearTimeout(l),l=null),window.removeEventListener("message",c),a&&a.parentNode&&a.parentNode.removeChild(a),a=null,r=!1,i.clear()}const p={small:{width:"400px",height:"600px",maxWidth:"calc(100vw - 40px)",maxHeight:"calc(100vh - 120px)"},medium:{width:"500px",height:"700px",maxWidth:"calc(100vw - 40px)",maxHeight:"calc(100vh - 80px)"},large:{width:"700px",height:"800px",maxWidth:"calc(100vw - 40px)",maxHeight:"calc(100vh - 40px)"},full:{width:"100vw",height:"100vh",maxWidth:"100vw",maxHeight:"100vh"}};function u(t,e){const n="full"===t.popupSize,o=function(t){return"400px"!==t.popupWidth||"600px"!==t.popupHeight||"calc(100vw - 40px)"!==t.popupMaxWidth||"calc(100vh - 120px)"!==t.popupMaxHeight?{width:t.popupWidth,height:t.popupHeight,maxWidth:t.popupMaxWidth,maxHeight:t.popupMaxHeight}:p[t.popupSize]||p.small}(t),i=document.createElement("div");i.id="aigentyc-overlay",i.style.cssText=`\n    position: fixed;\n    inset: 0;\n    background-color: rgba(0, 0, 0, ${n?"0":"0.5"});\n    z-index: ${t.zIndex+1};\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity 0.3s ease, visibility 0.3s ease;\n  `;const a=document.createElement("div");let r;a.id="aigentyc-popup",a.dataset.size=t.popupSize,r=n?"inset: 0;":"bottom-left"===t.position?"bottom: 90px; left: 20px; right: auto;":"bottom: 90px; right: 20px; left: auto;",a.style.cssText=`\n    position: fixed;\n    ${r}\n    width: ${o.width};\n    max-width: ${o.maxWidth};\n    height: ${o.height};\n    max-height: ${o.maxHeight};\n    background-color: white;\n    border-radius: ${n?"0":"16px"};\n    box-shadow: ${n?"none":"0 10px 40px rgba(0, 0, 0, 0.2)"};\n    z-index: ${t.zIndex+2};\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    opacity: 0;\n    visibility: hidden;\n    transform: ${n?"none":"translateY(20px) scale(0.95)"};\n    transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;\n  `;const l=document.createElement("div");l.style.cssText=`\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 12px 16px;\n    background-color: ${t.buttonColor};\n    color: white;\n    flex-shrink: 0;\n  `;const s=document.createElement("button");s.setAttribute("aria-label","Close chat"),s.setAttribute("type","button"),s.style.cssText="\n    background: none;\n    border: none;\n    color: white;\n    cursor: pointer;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    position: absolute;\n    padding: 10px;\n    right: 0;\n    top: 0;\n    transition: background-color 0.2s ease;\n  ",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',s.addEventListener("mouseenter",()=>{s.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="transparent"}),s.addEventListener("click",e),l.appendChild(s);const c=document.createElement("div");return c.id="aigentyc-iframe-container",c.style.cssText="\n    flex: 1;\n    overflow: hidden;\n    background-color: #f5f5f5;\n  ",a.appendChild(l),a.appendChild(c),i.addEventListener("click",e),document.addEventListener("keydown",t=>{"Escape"===t.key&&e()}),{overlay:i,container:a,header:l,closeButton:s,iframeContainer:c}}let m=null,g=null,h=!1,x=!1,y=null;function f(t){y||(y=document.createElement("style"),y.setAttribute("data-aigentyc",""),y.textContent='@media (max-width: 480px){#aigentyc-popup{width:calc(100vw - 20px)!important;height:calc(100vh - 100px)!important;max-height:none!important;bottom:10px!important;left:10px!important;right:10px!important;border-radius:12px!important}#aigentyc-trigger{bottom:16px!important;right:16px!important;width:52px!important;height:52px!important}}#aigentyc-iframe-container.loading{display:flex;align-items:center;justify-content:center}#aigentyc-iframe-container.loading:after{content:"";width:32px;height:32px;border:3px solid #e0e0e0;border-top-color:#1735aa;border-radius:50%;animation:aigentyc-spin .8s linear infinite}@keyframes aigentyc-spin{to{transform:rotate(360deg)}}#aigentyc-iframe-container iframe{width:100%;height:100%;border:none}#aigentyc-trigger:focus-visible,#aigentyc-popup button:focus-visible{outline:2px solid #fff;outline-offset:2px}@media (prefers-reduced-motion: reduce){#aigentyc-trigger,#aigentyc-overlay,#aigentyc-popup{transition:none!important}#aigentyc-iframe-container.loading:after{animation:none}}',document.head.appendChild(y)),m=function(t,e){const n=document.createElement("button");n.id="aigentyc-trigger",n.setAttribute("aria-label",t.buttonText||"Open chat"),n.setAttribute("type","button");const o="bottom-left"===t.position?"left: 20px; right: auto;":"right: 20px; left: auto;";return n.style.cssText=`\n    position: fixed;\n    bottom: 20px;\n    ${o}\n    z-index: ${t.zIndex};\n    width: 56px;\n    height: 56px;\n    border-radius: 50%;\n    border: none;\n    background-color: ${t.buttonColor};\n    color: white;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n    padding: 0;\n  `,n.innerHTML=t.buttonIcon?`<img src="${t.buttonIcon}" alt="" style="width: 24px; height: 24px;">`:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',t.buttonText&&(n.style.width="auto",n.style.borderRadius="28px",n.style.padding="0 20px",n.style.gap="8px",n.innerHTML+=`<span style="font-size: 14px; font-weight: 500;">${t.buttonText}</span>`),n.addEventListener("mouseenter",()=>{n.style.transform="scale(1.05)",n.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.2)"}),n.addEventListener("mouseleave",()=>{n.style.transform="scale(1)",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"}),n.addEventListener("click",e),n}(t,()=>b(t)),document.body.appendChild(m),g=u(t,v),document.body.appendChild(g.overlay),document.body.appendChild(g.container)}function b(t){g&&!h&&(h=!0,function(t){const e="full"===t.container.dataset.size;t.overlay.style.opacity="1",t.overlay.style.visibility="visible",t.container.style.opacity="1",t.container.style.visibility="visible",e||(t.container.style.transform="translateY(0) scale(1)"),e&&(document.body.style.overflow="hidden")}(g),m&&(m.style.display="none"),x||(g.iframeContainer.classList.add("loading"),s(t,g.iframeContainer),i.on("ready",()=>{x=!0,null==g||g.iframeContainer.classList.remove("loading")}),i.on("error",()=>{null==g||g.iframeContainer.classList.remove("loading"),g&&(g.iframeContainer.innerHTML='\n          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center; padding: 20px;">\n            <p style="margin: 0 0 10px;">Failed to load chat</p>\n            <button onclick="location.reload()" style="padding: 8px 16px; background: #1735aa; color: white; border: none; border-radius: 4px; cursor: pointer;">Retry</button>\n          </div>\n        ')})),i.emit("open"))}function v(){g&&h&&(h=!1,function(t){const e="full"===t.container.dataset.size;t.overlay.style.opacity="0",t.overlay.style.visibility="hidden",t.container.style.opacity="0",t.container.style.visibility="hidden",e||(t.container.style.transform="translateY(20px) scale(0.95)"),e&&(document.body.style.overflow="")}(g),m&&(m.style.display="flex"),i.emit("close"))}let w,C=null,k=null,E=!1,$=null;function z(t){return C=document.querySelector(t.trigger),C?(k=document.querySelector(t.container),k?($=()=>function(t){if(!k)return;E||(s(t,k),E=!0)}(t),void C.addEventListener("click",$)):(console.error(`[aiGentyc] Container element not found: ${t.container}`),void i.emit("error",new Error(`Container element not found: ${t.container}`)))):(console.error(`[aiGentyc] Trigger element not found: ${t.trigger}`),void i.emit("error",new Error(`Trigger element not found: ${t.trigger}`)))}let H=null;function T(){w=o(),console.log(w),w.project?(window.addEventListener("message",c),"custom"===w.mode?(H="custom",z(w)):(H="managed",f(w))):console.error("[aiGentyc] Cannot initialize: missing project ID")}const L={on:(t,e)=>i.on(t,e),off:(t,e)=>i.off(t,e),open:function(){"managed"===H?b(w):console.warn("[aiGentyc] open() is only available in managed mode")},close:function(){"managed"===H?v():console.warn("[aiGentyc] close() is only available in managed mode")},destroy:function(){var t;"managed"===H?(m&&(m.remove(),m=null),g&&((t=g).overlay.remove(),t.container.remove(),g=null),y&&(y.remove(),y=null),d(),h=!1,x=!1):"custom"===H&&(C&&$&&C.removeEventListener("click",$),C=null,k=null,$=null,E=!1,d()),d(),H=null},clearChat:function(){var t,e;t="clearChat",a&&a.contentWindow?a.contentWindow.postMessage({type:t,data:e},"*"):console.warn("[aiGentyc] Cannot send message: iframe not ready")},get config(){return w}};return window.aiGentyc=L,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",T):T(),L}();
